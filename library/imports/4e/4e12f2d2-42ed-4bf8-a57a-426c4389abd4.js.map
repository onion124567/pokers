{"version":3,"sources":["assets\\scripts\\Game.js"],"names":["PokerUtil","require","AIHelper","cc","Class","Component","properties","starPrefab","type","Prefab","cardPrefab","maxStarDuration","minStarDuration","currentCardPosition","startCardPostion","cardWidth","logicHelper","cardArray","String","pokerPlayer","roundPoker","playerControlNodeArray","refreshButton","Button","sendButton","currentWinner","gameHost","layoutContainer","Layout","layoutBottom","layoutTop","layoutLeft","layoutRight","logLabel","Label","playLog","ground","Node","player","scoreDisplay","scoreAudio","AudioClip","onLoad","groundY","y","height","timer","starDuration","i","pre","j","str","push","node","on","refreshCallback","sendCallback","publishPokers","score","roundProgram","onUserPlayCallBack","onRoundCallBack","roundOverCallBack","roundHost","sendArray","currentPlayer","sendCard","sendAIFollowCard","saveRoundPoker","winnerPosition","sumSocer","destoryArray","button","willSendCard","length","getComponent","isCheck","picNum","message","checkUserCanSend","console","log","destroy","splice","index","offset","newStar","instantiate","scaleX","scaleY","addChild","removePokerFromArray","spawnNewStar","setPosition","getNewStarPosition","game","Math","random","spawnBottomCard","destoryNode","createBottomCard","startPosition","userObj","total","randX","randY","jumpHeight","maxX","width","v2","getCardBottomPosition","update","dt","gainScore","string","audioEngine","playEffect","gameOver","stopAllActions","director","loadScene","pokerArray","slice","host","parseInt","playerPokerArray","pokerNum","value","quaryPokerTypeValue","appendLog","quaryPokerValue","expandPlayer","playerObj","sortPokers","JSON","stringify","location"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\nlet PokerUtil = require(\"PokerUtil\");\r\nlet AIHelper = require(\"AIHelper\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 这个属性引用了星星预制资源\r\n        starPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        cardPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        // 星星产生后消失时间的随机范围\r\n        maxStarDuration: 0,\r\n        minStarDuration: 0,\r\n        currentCardPosition: 0,\r\n        startCardPostion: 0,\r\n        cardWidth: 80,\r\n        logicHelper: null,\r\n        cardArray: [cc.String],\r\n        //初始牌数组 逆时针 主角是第一个数组\r\n        pokerPlayer: [],\r\n        //当前轮次出牌节点,\r\n        roundPoker: [],\r\n        //主角当前牌节点\r\n        playerControlNodeArray: [],\r\n        //洗牌\r\n        refreshButton: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n        //出牌\r\n        sendButton: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n\r\n        //当前胜方\r\n        currentWinner: 1,\r\n        //本轮主\r\n        gameHost: \"1\",\r\n        //玩家拥有牌\r\n        layoutContainer: {\r\n            default: null,\r\n            type: cc.Layout\r\n        },\r\n        //玩家出的牌 \r\n        layoutBottom: {\r\n            default: null,\r\n            type: cc.Layout\r\n        },\r\n        //对家出牌 第三位\r\n        layoutTop: {\r\n            default: null,\r\n            type: cc.Layout\r\n        },\r\n        //下家出牌 左手第二位\r\n        layoutLeft: {\r\n            default: null,\r\n            type: cc.Layout\r\n        },\r\n        //上家出牌，右手第四位\r\n        layoutRight: {\r\n            default: null,\r\n            type: cc.Layout\r\n        },\r\n        //战报\r\n        logLabel: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        playLog: \"游戏开始\",\r\n        // 地面节点，用于确定星星生成的高度\r\n        ground: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // player 节点，用于获取主角弹跳的高度，和控制主角行动开关\r\n        player: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // score label 的引用\r\n        scoreDisplay: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        // 得分音效资源\r\n        scoreAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n    },\r\n\r\n    onLoad: function () {\r\n        // 获取地平面的 y 轴坐标\r\n        this.groundY = this.ground.y + this.ground.height / 2;\r\n        // 初始化计时器\r\n        this.timer = 0;\r\n        this.starDuration = 0;\r\n        this.logicHelper = new AIHelper();\r\n        //创建图片资源\r\n        for (let i = 0; i < 13; i++) {\r\n            let pre = 3 + i;\r\n            for (let j = 1; j < 5; j++) {\r\n                let str = \"\";\r\n                if (pre < 10) {\r\n                    str = \"0\";\r\n                }\r\n                str = str + pre + j;\r\n                this.cardArray.push(str);\r\n                this.cardArray.push(str);\r\n            }\r\n        }\r\n        this.cardArray.push(\"161\");\r\n        this.cardArray.push(\"161\");\r\n        this.cardArray.push(\"171\");\r\n        this.cardArray.push(\"171\");\r\n\r\n\r\n        this.refreshButton.node.on('click', this.refreshCallback, this);\r\n        this.sendButton.node.on('click', this.sendCallback, this);\r\n        this.publishPokers();\r\n        // this.spawnNewStar();\r\n        // 初始化计分\r\n        this.score = 0;\r\n        this.logicHelper.roundProgram(this.onUserPlayCallBack,this.onRoundCallBack,this.roundOverCallBack,0,this.gameHost,[]);\r\n    },\r\n    /**\r\n     * 电脑出牌，直接渲染\r\n     * @param gameHost\r\n     * @param roundHost\r\n     * @param sendArray\r\n     * @param currentPlayer\r\n     */\r\n     onRoundCallBack:function(gameHost, roundHost, sendArray, currentPlayer){\r\n         this.roundHost=roundHost;\r\n         this.sendArray=sendArray;\r\n       let sendCard= this.logicHelper.sendAIFollowCard(this.gameHost, roundHost, sendArray, this.pokerPlayer[currentPlayer]);\r\n        sendArray.push(sendCard);\r\n        this.saveRoundPoker(sendCard, currentPlayer+1, 0);\r\n    },\r\n    /**\r\n     * 玩家出牌 出牌按钮可以点击\r\n     * @param gameHost\r\n     * @param roundHost\r\n     * @param sendArray\r\n     * @param currentPlayer\r\n     */\r\n    onUserPlayCallBack:function (gameHost, roundHost, sendArray, currentPlayer) {\r\n\r\n    },\r\n\r\n    roundOverCallBack:function(winnerPosition,sumSocer){\r\n        PokerUtil.destoryArray(this.roundPoker);\r\n        this.score=sumSocer+this.score;\r\n        this.roundHost=null;\r\n        this.logicHelper.roundProgram(this.onUserPlayCallBack,this.onRoundCallBack,\r\n            this.roundOverCallBack,winnerPosition,this.gameHost,[]);\r\n    },\r\n\r\n\r\n    refreshCallback: function (button) {\r\n        this.publishPokers();\r\n    },\r\n    sendCallback: function (button) {\r\n        // let sendArray = [];\r\n        let willSendCard=[];\r\n        for (let i = 0; i < this.playerControlNodeArray.length;i++) {\r\n            //判断是否可出\r\n            let node = this.playerControlNodeArray[i].getComponent('Card');\r\n            if (node.isCheck) {\r\n                willSendCard.push(node.picNum);\r\n            }\r\n            // this.playerControlNodeArray[i].destroy();\r\n        }\r\n        let message=this.logicHelper.checkUserCanSend(this.gameHost,this.roundHost,this.pokerPlayer[0],willSendCard);\r\n        if(!message){\r\n            console.log(\"onion\",\"不能出\"+message);\r\n            return\r\n        }\r\n\r\n        //出牌 移除并添加\r\n        for (let i = 0; i < this.playerControlNodeArray.length;) {\r\n            //判断是否可出\r\n            let node = this.playerControlNodeArray[i].getComponent('Card');\r\n            if (node.isCheck) {\r\n                // willSendArray.push(node.picNum);\r\n                this.saveRoundPoker(node.picNum, 1, i * this.cardWidth);\r\n                this.playerControlNodeArray[i].destroy();\r\n                this.playerControlNodeArray.splice(i, 1);\r\n            } else {\r\n                i++;\r\n            }\r\n            // this.playerControlNodeArray[i].destroy();\r\n        }\r\n        this.sendArray.push(willSendCard);\r\n        this.logicHelper.roundProgram(this.onUserPlayCallBack,this.onRoundCallBack,\r\n            this.roundOverCallBack,0,this.gameHost,this.sendArray);\r\n        // let secondCardArray = this.logicHelper.sendAIFollowCard(this.gameHost, 1, sendArray, this.pokerPlayer[1]);\r\n        //\r\n        // sendArray.push(secondCardArray);\r\n        //\r\n        // this.saveRoundPoker(secondCardArray, 2, 0);\r\n        // let thridCardArray = this.logicHelper.sendAIFollowCard(this.gameHost, 2, sendArray, this.pokerPlayer[2]);\r\n        // sendArray.push(thridCardArray);\r\n        // this.saveRoundPoker(thridCardArray, 3, 0);\r\n        // this.appendLog(\"我出\" + sendArray + \"下家出\" + secondCardArray + \"对家出\" + thridCardArray);\r\n    },\r\n    //保存出牌  1 2 3 4 顺时针位\r\n    saveRoundPoker: function (picNum, index, offset) {\r\n        var newStar = cc.instantiate(this.cardPrefab);\r\n        // newStar.setPicNum(\"i\"+i);\r\n        newStar.getComponent('Card').picNum = picNum;\r\n        newStar.scaleX = 0.5;\r\n        newStar.scaleY = 0.5;\r\n        this.roundPoker.push(newStar);\r\n        // this.node.addChild(newStar);\r\n        // let height = this.ground.height / 2 * -1;\r\n        switch (index) {\r\n            case 1: this.layoutBottom.node.addChild(newStar);\r\n                this.logicHelper.removePokerFromArray(this.gameHost, picNum, this.pokerPlayer[0]);\r\n                break;\r\n            case 2: this.layoutLeft.node.addChild(newStar);\r\n                this.logicHelper.removePokerFromArray(this.gameHost, picNum, this.pokerPlayer[1]);\r\n                break;\r\n            case 3: this.layoutTop.node.addChild(newStar);\r\n                this.logicHelper.removePokerFromArray(this.gameHost, picNum, this.pokerPlayer[2]);\r\n                break;\r\n            case 4: this.layoutRight.node.addChild(newStar);\r\n                this.logicHelper.removePokerFromArray(this.gameHost, picNum, this.pokerPlayer[3]);\r\n                break;\r\n        }\r\n        // newStar.setPosition(cc.v2(-150 + this.startCardPostion + offset, height));\r\n    },\r\n    spawnNewStar: function () {\r\n        // 使用给定的模板在场景中生成一个新节点\r\n        var newStar = cc.instantiate(this.starPrefab);\r\n        // 将新增的节点添加到 Canvas 节点下面\r\n        this.node.addChild(newStar);\r\n        // 为星星设置一个随机位置\r\n        newStar.setPosition(this.getNewStarPosition());\r\n        // 在星星组件上暂存 Game 对象的引用\r\n        newStar.getComponent('Star').game = this;\r\n        // 重置计时器，根据消失时间范围随机取一个值\r\n        this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);\r\n        this.timer = 0;\r\n    },\r\n    /**\r\n     * 移除旧的节点\r\n     * 添加新节点\r\n     */\r\n    spawnBottomCard: function () {\r\n        if (this.playerControlNodeArray.length > 0) {\r\n            let destoryNode = this.playerControlNodeArray;\r\n            PokerUtil.destoryArray(destoryNode);\r\n            this.playerControlNodeArray = [];\r\n        }\r\n\r\n        this.createBottomCard()\r\n\r\n    },\r\n\r\n    /**\r\n     * type1Array:type1Array,\r\n            type2Array:type2Array,\r\n            type3Array:type3Array,\r\n            type4Array:type4Array,\r\n            hostArray:hostArray,\r\n            total:total\r\n     */\r\n    createBottomCard: function () {\r\n\r\n        let startPosition = 0;\r\n        let userObj = this.pokerPlayer[0];\r\n        for (let i = 0; i < userObj.total.length; i++) {\r\n            // 使用给定的模板在场景中生成一个新节点\r\n            var newStar = cc.instantiate(this.cardPrefab);\r\n            // newStar.setPicNum(\"i\"+i);\r\n            newStar.getComponent('Card').picNum = userObj.total[i];\r\n            this.playerControlNodeArray.push(newStar);\r\n            // this.node.addChild(newStar);\r\n            this.layoutContainer.node.addChild(newStar);\r\n            let height = this.ground.height / 2 * -1;\r\n            startPosition = i * this.cardWidth;\r\n            if (i > 13) {\r\n                height = height - 150\r\n                startPosition = (i - 13) * this.cardWidth;\r\n            }\r\n            // newStar.setPosition(cc.v2(-200 + this.startCardPostion + startPosition, height));\r\n        }\r\n    },\r\n\r\n\r\n    getNewStarPosition: function () {\r\n        var randX = 0;\r\n        // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\r\n        var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 50;\r\n        // 根据屏幕宽度，随机得到一个星星 x 坐标\r\n        var maxX = this.node.width / 2;\r\n        randX = (Math.random() - 0.5) * 2 * maxX;\r\n        // 返回星星坐标\r\n        return cc.v2(randX, randY);\r\n    },\r\n    getCardBottomPosition: function () {\r\n        var randX = this.currentCardPosition;\r\n        var randY = 0;\r\n        this.currentCardPosition = this.currentCardPosition + this.cardWidth;\r\n        return cc.v2(randX, randY);\r\n    },\r\n\r\n    update: function (dt) {\r\n        // 每帧更新计时器，超过限度还没有生成新的星星\r\n        // 就会调用游戏失败逻辑\r\n        // if (this.timer > this.starDuration) {\r\n        //     this.gameOver();\r\n        //     this.enabled = false;   // disable gameOver logic to avoid load scene repeatedly\r\n        //     return;\r\n        // }\r\n        // this.timer += dt;\r\n    },\r\n\r\n    gainScore: function () {\r\n        this.score += 1;\r\n        // 更新 scoreDisplay Label 的文字\r\n        this.scoreDisplay.string = 'Score: ' + this.score;\r\n        // 播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n    },\r\n\r\n    gameOver: function () {\r\n        this.player.stopAllActions(); //停止 player 节点的跳跃动作\r\n        cc.director.loadScene('game');\r\n    },\r\n\r\n    /**\r\n    * 把牌发给四家\r\n    */\r\n    publishPokers: function () {\r\n        this.pokerPlayer = [];\r\n        this.gameHost = null;\r\n        let pokerArray = this.cardArray.slice(0);\r\n        let host = parseInt(Math.random() * 4);//随机主牌花色\r\n        for (let i = 0; i < 4; i++) {\r\n            let playerPokerArray = [];\r\n            for (let j = 0; j < 27; j++) {\r\n                let pokerNum = Math.random() * pokerArray.length;\r\n                pokerNum = parseInt(pokerNum);\r\n                //插入手牌中\r\n                let value = pokerArray.splice(pokerNum, 1);\r\n                playerPokerArray.push(value);\r\n                if (this.gameHost == null) {//随机到主后，第一张主牌亮出\r\n                    if (host == PokerUtil.quaryPokerTypeValue(value)) {\r\n                        this.gameHost = value;\r\n                        this.appendLog(\"本轮游戏,主牌\" + PokerUtil.quaryPokerValue(value) + \"在\" + this.expandPlayer(i));\r\n                    }\r\n                }\r\n            }\r\n            let playerObj = PokerUtil.sortPokers(host, playerPokerArray);\r\n            console.log(\"onion====\", JSON.stringify(playerObj));\r\n            this.pokerPlayer.push(playerObj);\r\n        }\r\n        this.spawnBottomCard();\r\n\r\n    },\r\n    expandPlayer: function (location) {\r\n        switch (location) {\r\n            case 0: return \"自己\"\r\n            case 1: return \"下家\"\r\n            case 2: return \"对家\"\r\n            case 3: return \"上家\"\r\n        }\r\n\r\n    },\r\n    appendLog: function (string) {\r\n        this.playLog = this.playLog + \"\\n\" + string;\r\n        this.logLabel.string = this.playLog;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n});\r\n"]}