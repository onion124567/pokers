
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Game.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '4e12fLSQu1L+KV6QmxDiavU', 'Game');
// scripts/Game.js

"use strict";

var PokerUtil = require("PokerUtil");

cc.Class({
  "extends": cc.Component,
  properties: {
    // 这个属性引用了星星预制资源
    starPrefab: {
      "default": null,
      type: cc.Prefab
    },
    cardPrefab: {
      "default": null,
      type: cc.Prefab
    },
    // 星星产生后消失时间的随机范围
    maxStarDuration: 0,
    minStarDuration: 0,
    currentCardPosition: 0,
    startCardPostion: 0,
    cardWidth: 80,
    cardArray: [cc.String],
    //初始牌数组 逆时针 主角是第一个数组
    pokerPlayer: [],
    //当前轮次出牌节点,
    roundPoker: [],
    //主角当前牌节点
    playerControlNodeArray: [],
    //洗牌
    refreshButton: {
      "default": null,
      type: cc.Button
    },
    //出牌
    sendButton: {
      "default": null,
      type: cc.Button
    },
    //当前胜方
    currentWinner: 1,
    //本轮主
    gameHost: "1",
    //玩家拥有牌
    layoutContainer: {
      "default": null,
      type: cc.Layout
    },
    //玩家出的牌 
    layoutBottom: {
      "default": null,
      type: cc.Layout
    },
    //对家出牌 第三位
    layoutTop: {
      "default": null,
      type: cc.Layout
    },
    //下家出牌 左手第二位
    layoutLeft: {
      "default": null,
      type: cc.Layout
    },
    //上家出牌，右手第四位
    layoutRight: {
      "default": null,
      type: cc.Layout
    },
    //战报
    logLabel: {
      "default": null,
      type: cc.Label
    },
    playLog: "游戏开始",
    // 地面节点，用于确定星星生成的高度
    ground: {
      "default": null,
      type: cc.Node
    },
    // player 节点，用于获取主角弹跳的高度，和控制主角行动开关
    player: {
      "default": null,
      type: cc.Node
    },
    // score label 的引用
    scoreDisplay: {
      "default": null,
      type: cc.Label
    },
    // 得分音效资源
    scoreAudio: {
      "default": null,
      type: cc.AudioClip
    }
  },
  onLoad: function onLoad() {
    // 获取地平面的 y 轴坐标
    this.groundY = this.ground.y + this.ground.height / 2; // 初始化计时器

    this.timer = 0;
    this.starDuration = 0; //创建图片资源

    for (var i = 0; i < 13; i++) {
      var pre = 3 + i;

      for (var j = 1; j < 5; j++) {
        var str = "";

        if (pre < 10) {
          str = "0";
        }

        str = str + pre + j;
        this.cardArray.push(str);
        this.cardArray.push(str);
      }
    }

    this.cardArray.push("161");
    this.cardArray.push("161");
    this.cardArray.push("171");
    this.cardArray.push("171");
    this.refreshButton.node.on('click', this.refreshCallback, this);
    this.sendButton.node.on('click', this.sendCallback, this);
    this.publishPokers(); // this.spawnNewStar();
    // 初始化计分

    this.score = 0;
  },
  refreshCallback: function refreshCallback(button) {
    this.publishPokers();
  },
  sendCallback: function sendCallback(button) {
    var testArray = [];
    PokerUtil.destoryArray(this.roundPoker);

    for (var i = 0; i < this.playerControlNodeArray.length;) {
      //判断是否可出
      var node = this.playerControlNodeArray[i].getComponent('Card');

      if (node.isCheck) {
        console.log("onion 选中" + PokerUtil.quaryPokerValue(node.picNum));
        testArray.push(node.picNum);
        this.saveRoundPoker(node.picNum, 1, i * this.cardWidth);
        this.playerControlNodeArray[i].destroy();
        this.playerControlNodeArray.splice(i, 1);
      } else {
        i++;
      } // this.playerControlNodeArray[i].destroy();

    }

    PokerUtil.testLogic(testArray);
    this.appendLog("追加牌内容");
  },
  //保存出牌  1 2 3 4 顺时针位
  saveRoundPoker: function saveRoundPoker(picNum, index, offset) {
    var newStar = cc.instantiate(this.cardPrefab); // newStar.setPicNum("i"+i);

    newStar.getComponent('Card').picNum = picNum;
    newStar.scaleX = 0.5;
    newStar.scaleY = 0.5;
    this.roundPoker.push(newStar); // this.node.addChild(newStar);
    // let height = this.ground.height / 2 * -1;

    if (index === 1) {
      // height = height + 100;
      this.layoutBottom.node.addChild(newStar);
    } // newStar.setPosition(cc.v2(-150 + this.startCardPostion + offset, height));

  },
  spawnNewStar: function spawnNewStar() {
    // 使用给定的模板在场景中生成一个新节点
    var newStar = cc.instantiate(this.starPrefab); // 将新增的节点添加到 Canvas 节点下面

    this.node.addChild(newStar); // 为星星设置一个随机位置

    newStar.setPosition(this.getNewStarPosition()); // 在星星组件上暂存 Game 对象的引用

    newStar.getComponent('Star').game = this; // 重置计时器，根据消失时间范围随机取一个值

    this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);
    this.timer = 0;
  },

  /**
   * 移除旧的节点
   * 添加新节点
   */
  spawnBottomCard: function spawnBottomCard() {
    if (this.playerControlNodeArray.length > 0) {
      var destoryNode = this.playerControlNodeArray;
      PokerUtil.destoryArray(destoryNode);
      this.playerControlNodeArray = [];
    }

    console.log("spawnBottomCard " + this.pokerPlayer[0].length);
    this.createBottomCard();
  },
  createBottomCard: function createBottomCard() {
    var startPosition = 0;

    for (var i = 0; i < this.pokerPlayer[0].length; i++) {
      // 使用给定的模板在场景中生成一个新节点
      var newStar = cc.instantiate(this.cardPrefab); // newStar.setPicNum("i"+i);

      newStar.getComponent('Card').picNum = this.pokerPlayer[0][i];
      this.playerControlNodeArray.push(newStar); // this.node.addChild(newStar);

      this.layoutContainer.node.addChild(newStar);
      var height = this.ground.height / 2 * -1;
      startPosition = i * this.cardWidth;

      if (i > 13) {
        height = height - 150;
        startPosition = (i - 13) * this.cardWidth;
      } // newStar.setPosition(cc.v2(-200 + this.startCardPostion + startPosition, height));

    }
  },
  getNewStarPosition: function getNewStarPosition() {
    var randX = 0; // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标

    var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 50; // 根据屏幕宽度，随机得到一个星星 x 坐标

    var maxX = this.node.width / 2;
    randX = (Math.random() - 0.5) * 2 * maxX; // 返回星星坐标

    return cc.v2(randX, randY);
  },
  getCardBottomPosition: function getCardBottomPosition() {
    var randX = this.currentCardPosition;
    var randY = 0;
    this.currentCardPosition = this.currentCardPosition + this.cardWidth;
    return cc.v2(randX, randY);
  },
  update: function update(dt) {// 每帧更新计时器，超过限度还没有生成新的星星
    // 就会调用游戏失败逻辑
    // if (this.timer > this.starDuration) {
    //     this.gameOver();
    //     this.enabled = false;   // disable gameOver logic to avoid load scene repeatedly
    //     return;
    // }
    // this.timer += dt;
  },
  gainScore: function gainScore() {
    this.score += 1; // 更新 scoreDisplay Label 的文字

    this.scoreDisplay.string = 'Score: ' + this.score; // 播放得分音效

    cc.audioEngine.playEffect(this.scoreAudio, false);
  },
  gameOver: function gameOver() {
    this.player.stopAllActions(); //停止 player 节点的跳跃动作

    cc.director.loadScene('game');
  },

  /**
  * 把牌发给四家
  */
  publishPokers: function publishPokers() {
    this.pokerPlayer = [];
    var pokerArray = this.cardArray.slice(0);
    var host = parseInt(Math.random() * 4);

    for (var i = 0; i < 4; i++) {
      var playerPokerArray = [];

      for (var j = 0; j < 27; j++) {
        var pokerNum = Math.random() * pokerArray.length;
        pokerNum = parseInt(pokerNum);
        var value = pokerArray.splice(pokerNum, 1);
        playerPokerArray.push(value);

        if (i == host && j == 26) {
          //随机方的最后一张牌做主
          this.gameHost = PokerUtil.quaryPokerTypeValue(value);
          this.appendLog("本轮游戏主" + PokerUtil.quaryType(this.gameHost) + ",主牌" + PokerUtil.quaryPokerValue(value) + "在" + this.expandPlayer(i));
        }
      }

      this.pokerPlayer.push(playerPokerArray);
    }

    this.spawnBottomCard();
  },
  expandPlayer: function expandPlayer(location) {
    switch (location) {
      case 0:
        return "自己";

      case 1:
        return "下家";

      case 2:
        return "对家";

      case 3:
        return "上家";
    }
  },
  appendLog: function appendLog(string) {
    this.playLog = this.playLog + "\n" + string;
    this.logLabel.string = this.playLog;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcR2FtZS5qcyJdLCJuYW1lcyI6WyJQb2tlclV0aWwiLCJyZXF1aXJlIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJzdGFyUHJlZmFiIiwidHlwZSIsIlByZWZhYiIsImNhcmRQcmVmYWIiLCJtYXhTdGFyRHVyYXRpb24iLCJtaW5TdGFyRHVyYXRpb24iLCJjdXJyZW50Q2FyZFBvc2l0aW9uIiwic3RhcnRDYXJkUG9zdGlvbiIsImNhcmRXaWR0aCIsImNhcmRBcnJheSIsIlN0cmluZyIsInBva2VyUGxheWVyIiwicm91bmRQb2tlciIsInBsYXllckNvbnRyb2xOb2RlQXJyYXkiLCJyZWZyZXNoQnV0dG9uIiwiQnV0dG9uIiwic2VuZEJ1dHRvbiIsImN1cnJlbnRXaW5uZXIiLCJnYW1lSG9zdCIsImxheW91dENvbnRhaW5lciIsIkxheW91dCIsImxheW91dEJvdHRvbSIsImxheW91dFRvcCIsImxheW91dExlZnQiLCJsYXlvdXRSaWdodCIsImxvZ0xhYmVsIiwiTGFiZWwiLCJwbGF5TG9nIiwiZ3JvdW5kIiwiTm9kZSIsInBsYXllciIsInNjb3JlRGlzcGxheSIsInNjb3JlQXVkaW8iLCJBdWRpb0NsaXAiLCJvbkxvYWQiLCJncm91bmRZIiwieSIsImhlaWdodCIsInRpbWVyIiwic3RhckR1cmF0aW9uIiwiaSIsInByZSIsImoiLCJzdHIiLCJwdXNoIiwibm9kZSIsIm9uIiwicmVmcmVzaENhbGxiYWNrIiwic2VuZENhbGxiYWNrIiwicHVibGlzaFBva2VycyIsInNjb3JlIiwiYnV0dG9uIiwidGVzdEFycmF5IiwiZGVzdG9yeUFycmF5IiwibGVuZ3RoIiwiZ2V0Q29tcG9uZW50IiwiaXNDaGVjayIsImNvbnNvbGUiLCJsb2ciLCJxdWFyeVBva2VyVmFsdWUiLCJwaWNOdW0iLCJzYXZlUm91bmRQb2tlciIsImRlc3Ryb3kiLCJzcGxpY2UiLCJ0ZXN0TG9naWMiLCJhcHBlbmRMb2ciLCJpbmRleCIsIm9mZnNldCIsIm5ld1N0YXIiLCJpbnN0YW50aWF0ZSIsInNjYWxlWCIsInNjYWxlWSIsImFkZENoaWxkIiwic3Bhd25OZXdTdGFyIiwic2V0UG9zaXRpb24iLCJnZXROZXdTdGFyUG9zaXRpb24iLCJnYW1lIiwiTWF0aCIsInJhbmRvbSIsInNwYXduQm90dG9tQ2FyZCIsImRlc3RvcnlOb2RlIiwiY3JlYXRlQm90dG9tQ2FyZCIsInN0YXJ0UG9zaXRpb24iLCJyYW5kWCIsInJhbmRZIiwianVtcEhlaWdodCIsIm1heFgiLCJ3aWR0aCIsInYyIiwiZ2V0Q2FyZEJvdHRvbVBvc2l0aW9uIiwidXBkYXRlIiwiZHQiLCJnYWluU2NvcmUiLCJzdHJpbmciLCJhdWRpb0VuZ2luZSIsInBsYXlFZmZlY3QiLCJnYW1lT3ZlciIsInN0b3BBbGxBY3Rpb25zIiwiZGlyZWN0b3IiLCJsb2FkU2NlbmUiLCJwb2tlckFycmF5Iiwic2xpY2UiLCJob3N0IiwicGFyc2VJbnQiLCJwbGF5ZXJQb2tlckFycmF5IiwicG9rZXJOdW0iLCJ2YWx1ZSIsInF1YXJ5UG9rZXJUeXBlVmFsdWUiLCJxdWFyeVR5cGUiLCJleHBhbmRQbGF5ZXIiLCJsb2NhdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQyxJQUFJQSxTQUFTLEdBQUdDLE9BQU8sQ0FBQyxXQUFELENBQXZCOztBQUNEQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUjtBQUNBQyxJQUFBQSxVQUFVLEVBQUU7QUFDUixpQkFBUyxJQUREO0FBRVJDLE1BQUFBLElBQUksRUFBRUwsRUFBRSxDQUFDTTtBQUZELEtBRko7QUFNUkMsSUFBQUEsVUFBVSxFQUFFO0FBQ1IsaUJBQVMsSUFERDtBQUVSRixNQUFBQSxJQUFJLEVBQUVMLEVBQUUsQ0FBQ007QUFGRCxLQU5KO0FBVVI7QUFDQUUsSUFBQUEsZUFBZSxFQUFFLENBWFQ7QUFZUkMsSUFBQUEsZUFBZSxFQUFFLENBWlQ7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LENBQUNrSCxTQUFWLENBQW9CLEtBQUsxRixRQUF6QixDQUFSLEdBQ2QsS0FEYyxHQUNSeEIsU0FBUyxDQUFDaUUsZUFBVixDQUEwQitDLEtBQTFCLENBRFEsR0FDeUIsR0FEekIsR0FDNkIsS0FBS0csWUFBTCxDQUFrQnJFLENBQWxCLENBRDVDO0FBRUg7QUFDSjs7QUFDRCxXQUFLN0IsV0FBTCxDQUFpQmlDLElBQWpCLENBQXNCNEQsZ0JBQXRCO0FBQ0g7O0FBQ0QsU0FBS3pCLGVBQUw7QUFFSCxHQTFSSTtBQTJSTDhCLEVBQUFBLFlBQVksRUFBQyxzQkFBU0MsUUFBVCxFQUFrQjtBQUMzQixZQUFPQSxRQUFQO0FBQ0ksV0FBSyxDQUFMO0FBQU8sZUFBTyxJQUFQOztBQUNQLFdBQUssQ0FBTDtBQUFPLGVBQU8sSUFBUDs7QUFDUCxXQUFLLENBQUw7QUFBTyxlQUFPLElBQVA7O0FBQ1AsV0FBSyxDQUFMO0FBQU8sZUFBTyxJQUFQO0FBSlg7QUFPSCxHQW5TSTtBQW9TTDdDLEVBQUFBLFNBQVMsRUFBQyxtQkFBUzRCLE1BQVQsRUFBZ0I7QUFDdEIsU0FBS2xFLE9BQUwsR0FBYSxLQUFLQSxPQUFMLEdBQWEsSUFBYixHQUFrQmtFLE1BQS9CO0FBQ0EsU0FBS3BFLFFBQUwsQ0FBY29FLE1BQWQsR0FBcUIsS0FBS2xFLE9BQTFCO0FBQ0g7QUF2U0ksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiXG4gbGV0IFBva2VyVXRpbCA9IHJlcXVpcmUoXCJQb2tlclV0aWxcIik7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICAvLyDov5nkuKrlsZ7mgKflvJXnlKjkuobmmJ/mmJ/pooTliLbotYTmupBcbiAgICAgICAgc3RhclByZWZhYjoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLlByZWZhYlxuICAgICAgICB9LFxuICAgICAgICBjYXJkUHJlZmFiOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuUHJlZmFiXG4gICAgICAgIH0sXG4gICAgICAgIC8vIOaYn+aYn+S6p+eUn+WQjua2iOWkseaXtumXtOeahOmaj+acuuiMg+WbtFxuICAgICAgICBtYXhTdGFyRHVyYXRpb246IDAsXG4gICAgICAgIG1pblN0YXJEdXJhdGlvbjogMCxcbiAgICAgICAgY3VycmVudENhcmRQb3NpdGlvbjogMCxcbiAgICAgICAgc3RhcnRDYXJkUG9zdGlvbjogMCxcbiAgICAgICAgY2FyZFdpZHRoOiA4MCxcbiAgICAgICAgXG4gICAgICAgIGNhcmRBcnJheTogW2NjLlN0cmluZ10sXG4gICAgICAgIC8v5Yid5aeL54mM5pWw57uEIOmAhuaXtumSiCDkuLvop5LmmK/nrKzkuIDkuKrmlbDnu4RcbiAgICAgICAgcG9rZXJQbGF5ZXI6IFtdLFxuICAgICAgICAvL+W9k+WJjei9ruasoeWHuueJjOiKgueCuSxcbiAgICAgICAgcm91bmRQb2tlcjogW10sXG4gICAgICAgIC8v5Li76KeS5b2T5YmN54mM6IqC54K5XG4gICAgICAgIHBsYXllckNvbnRyb2xOb2RlQXJyYXk6IFtdLFxuICAgICAgICAvL+a0l+eJjFxuICAgICAgICByZWZyZXNoQnV0dG9uOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuQnV0dG9uXG4gICAgICAgIH0sXG4gICAgICAgIC8v5Ye654mMXG4gICAgICAgIHNlbmRCdXR0b246IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5CdXR0b25cbiAgICAgICAgfSxcblxuICAgICAgICAvL+W9k+WJjeiDnOaWuVxuICAgICAgICBjdXJyZW50V2lubmVyOjEsXG4gICAgICAgIC8v5pys6L2u5Li7XG4gICAgICAgIGdhbWVIb3N0OlwiMVwiLFxuICAgICAgICAvL+eOqeWutuaLpeacieeJjFxuICAgICAgICBsYXlvdXRDb250YWluZXI6e1xuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxuICAgICAgICAgICAgdHlwZTpjYy5MYXlvdXRcbiAgICAgICAgfSxcbiAgICAgICAgLy/njqnlrrblh7rnmoTniYwgXG4gICAgICAgIGxheW91dEJvdHRvbTp7XG4gICAgICAgICAgICBkZWZhdWx0Om51bGwsXG4gICAgICAgICAgICB0eXBlOmNjLkxheW91dFxuICAgICAgICB9LFxuICAgICAgICAvL+WvueWutuWHuueJjCDnrKzkuInkvY1cbiAgICAgICAgbGF5b3V0VG9wOntcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcbiAgICAgICAgICAgIHR5cGU6Y2MuTGF5b3V0XG4gICAgICAgIH0sXG4gICAgICAgIC8v5LiL5a625Ye654mMIOW3puaJi+esrOS6jOS9jVxuICAgICAgICBsYXlvdXRMZWZ0OntcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcbiAgICAgICAgICAgIHR5cGU6Y2MuTGF5b3V0XG4gICAgICAgIH0sXG4gICAgICAgICAvL+S4iuWutuWHuueJjO+8jOWPs+aJi+esrOWbm+S9jVxuICAgICAgICBsYXlvdXRSaWdodDp7XG4gICAgICAgICAgICBkZWZhdWx0Om51bGwsXG4gICAgICAgICAgICB0eXBlOmNjLkxheW91dFxuICAgICAgICB9LFxuICAgICAgICAvL+aImOaKpVxuICAgICAgICBsb2dMYWJlbDp7XG4gICAgICAgICAgICBkZWZhdWx0Om51bGwsXG4gICAgICAgICAgICB0eXBlOmNjLkxhYmVsXG4gICAgICAgIH0sXG4gICAgICAgIHBsYXlMb2c6XCLmuLjmiI/lvIDlp4tcIixcbiAgICAgICAgLy8g5Zyw6Z2i6IqC54K577yM55So5LqO56Gu5a6a5pif5pif55Sf5oiQ55qE6auY5bqmXG4gICAgICAgIGdyb3VuZDoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGVcbiAgICAgICAgfSxcbiAgICAgICAgLy8gcGxheWVyIOiKgueCue+8jOeUqOS6juiOt+WPluS4u+inkuW8uei3s+eahOmrmOW6pu+8jOWSjOaOp+WItuS4u+inkuihjOWKqOW8gOWFs1xuICAgICAgICBwbGF5ZXI6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlXG4gICAgICAgIH0sXG4gICAgICAgIC8vIHNjb3JlIGxhYmVsIOeahOW8leeUqFxuICAgICAgICBzY29yZURpc3BsYXk6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5MYWJlbFxuICAgICAgICB9LFxuICAgICAgICAvLyDlvpfliIbpn7PmlYjotYTmupBcbiAgICAgICAgc2NvcmVBdWRpbzoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkF1ZGlvQ2xpcFxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8g6I635Y+W5Zyw5bmz6Z2i55qEIHkg6L205Z2Q5qCHXG4gICAgICAgIHRoaXMuZ3JvdW5kWSA9IHRoaXMuZ3JvdW5kLnkgKyB0aGlzLmdyb3VuZC5oZWlnaHQgLyAyO1xuICAgICAgICAvLyDliJ3lp4vljJborqHml7blmahcbiAgICAgICAgdGhpcy50aW1lciA9IDA7XG4gICAgICAgIHRoaXMuc3RhckR1cmF0aW9uID0gMDtcbiAgICAgICAgLy/liJvlu7rlm77niYfotYTmupBcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMzsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgcHJlID0gMyArIGk7XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMTsgaiA8IDU7IGorKykge1xuICAgICAgICAgICAgICAgIGxldCBzdHIgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGlmIChwcmUgPCAxMCkge1xuICAgICAgICAgICAgICAgICAgICBzdHIgPSBcIjBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3RyID0gc3RyICsgcHJlICsgajtcbiAgICAgICAgICAgICAgICB0aGlzLmNhcmRBcnJheS5wdXNoKHN0cik7XG4gICAgICAgICAgICAgICAgdGhpcy5jYXJkQXJyYXkucHVzaChzdHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FyZEFycmF5LnB1c2goXCIxNjFcIik7XG4gICAgICAgIHRoaXMuY2FyZEFycmF5LnB1c2goXCIxNjFcIik7XG4gICAgICAgIHRoaXMuY2FyZEFycmF5LnB1c2goXCIxNzFcIik7XG4gICAgICAgIHRoaXMuY2FyZEFycmF5LnB1c2goXCIxNzFcIik7XG5cblxuICAgICAgICB0aGlzLnJlZnJlc2hCdXR0b24ubm9kZS5vbignY2xpY2snLCB0aGlzLnJlZnJlc2hDYWxsYmFjaywgdGhpcyk7XG4gICAgICAgIHRoaXMuc2VuZEJ1dHRvbi5ub2RlLm9uKCdjbGljaycsIHRoaXMuc2VuZENhbGxiYWNrLCB0aGlzKTtcbiAgICAgICAgdGhpcy5wdWJsaXNoUG9rZXJzKCk7XG4gICAgICAgIC8vIHRoaXMuc3Bhd25OZXdTdGFyKCk7XG4gICAgICAgIC8vIOWIneWni+WMluiuoeWIhlxuICAgICAgICB0aGlzLnNjb3JlID0gMDtcbiAgICB9LFxuICAgIHJlZnJlc2hDYWxsYmFjazogZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICB0aGlzLnB1Ymxpc2hQb2tlcnMoKTtcbiAgICB9LFxuICAgIHNlbmRDYWxsYmFjazogZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICBsZXQgdGVzdEFycmF5PVtdO1xuICAgICAgICBQb2tlclV0aWwuZGVzdG9yeUFycmF5KHRoaXMucm91bmRQb2tlcik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5ZXJDb250cm9sTm9kZUFycmF5Lmxlbmd0aDspIHtcbiAgICAgICAgICAgIC8v5Yik5pat5piv5ZCm5Y+v5Ye6XG4gICAgICAgICAgICBsZXQgbm9kZSA9IHRoaXMucGxheWVyQ29udHJvbE5vZGVBcnJheVtpXS5nZXRDb21wb25lbnQoJ0NhcmQnKTtcbiAgICAgICAgICAgIGlmIChub2RlLmlzQ2hlY2spIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIm9uaW9uIOmAieS4rVwiICsgUG9rZXJVdGlsLnF1YXJ5UG9rZXJWYWx1ZShub2RlLnBpY051bSkpO1xuICAgICAgICAgICAgICAgIHRlc3RBcnJheS5wdXNoKG5vZGUucGljTnVtKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVSb3VuZFBva2VyKG5vZGUucGljTnVtLCAxLCBpICogdGhpcy5jYXJkV2lkdGgpO1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQ29udHJvbE5vZGVBcnJheVtpXS5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJDb250cm9sTm9kZUFycmF5LnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdGhpcy5wbGF5ZXJDb250cm9sTm9kZUFycmF5W2ldLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICAgUG9rZXJVdGlsLnRlc3RMb2dpYyh0ZXN0QXJyYXkpO1xuICAgICAgICAgdGhpcy5hcHBlbmRMb2coXCLov73liqDniYzlhoXlrrlcIik7XG4gICAgfSxcbiAgICAvL+S/neWtmOWHuueJjCAgMSAyIDMgNCDpobrml7bpkojkvY1cbiAgICBzYXZlUm91bmRQb2tlcjogZnVuY3Rpb24gKHBpY051bSwgaW5kZXgsIG9mZnNldCkge1xuICAgICAgICB2YXIgbmV3U3RhciA9IGNjLmluc3RhbnRpYXRlKHRoaXMuY2FyZFByZWZhYik7XG4gICAgICAgIC8vIG5ld1N0YXIuc2V0UGljTnVtKFwiaVwiK2kpO1xuICAgICAgICBuZXdTdGFyLmdldENvbXBvbmVudCgnQ2FyZCcpLnBpY051bSA9IHBpY051bTtcbiAgICAgICAgbmV3U3Rhci5zY2FsZVggPSAwLjU7XG4gICAgICAgIG5ld1N0YXIuc2NhbGVZID0gMC41O1xuICAgICAgICB0aGlzLnJvdW5kUG9rZXIucHVzaChuZXdTdGFyKTtcbiAgICAgICAgLy8gdGhpcy5ub2RlLmFkZENoaWxkKG5ld1N0YXIpO1xuICAgICAgICAvLyBsZXQgaGVpZ2h0ID0gdGhpcy5ncm91bmQuaGVpZ2h0IC8gMiAqIC0xO1xuICAgICAgICBpZiAoaW5kZXggPT09IDEpIHtcbiAgICAgICAgICAgIC8vIGhlaWdodCA9IGhlaWdodCArIDEwMDtcbiAgICAgICAgICAgIHRoaXMubGF5b3V0Qm90dG9tLm5vZGUuYWRkQ2hpbGQobmV3U3Rhcik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gbmV3U3Rhci5zZXRQb3NpdGlvbihjYy52MigtMTUwICsgdGhpcy5zdGFydENhcmRQb3N0aW9uICsgb2Zmc2V0LCBoZWlnaHQpKTtcbiAgICB9LFxuICAgIHNwYXduTmV3U3RhcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyDkvb/nlKjnu5nlrprnmoTmqKHmnb/lnKjlnLrmma/kuK3nlJ/miJDkuIDkuKrmlrDoioLngrlcbiAgICAgICAgdmFyIG5ld1N0YXIgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLnN0YXJQcmVmYWIpO1xuICAgICAgICAvLyDlsIbmlrDlop7nmoToioLngrnmt7vliqDliLAgQ2FudmFzIOiKgueCueS4i+mdolxuICAgICAgICB0aGlzLm5vZGUuYWRkQ2hpbGQobmV3U3Rhcik7XG4gICAgICAgIC8vIOS4uuaYn+aYn+iuvue9ruS4gOS4qumaj+acuuS9jee9rlxuICAgICAgICBuZXdTdGFyLnNldFBvc2l0aW9uKHRoaXMuZ2V0TmV3U3RhclBvc2l0aW9uKCkpO1xuICAgICAgICAvLyDlnKjmmJ/mmJ/nu4Tku7bkuIrmmoLlrZggR2FtZSDlr7nosaHnmoTlvJXnlKhcbiAgICAgICAgbmV3U3Rhci5nZXRDb21wb25lbnQoJ1N0YXInKS5nYW1lID0gdGhpcztcbiAgICAgICAgLy8g6YeN572u6K6h5pe25Zmo77yM5qC55o2u5raI5aSx5pe26Ze06IyD5Zu06ZqP5py65Y+W5LiA5Liq5YC8XG4gICAgICAgIHRoaXMuc3RhckR1cmF0aW9uID0gdGhpcy5taW5TdGFyRHVyYXRpb24gKyBNYXRoLnJhbmRvbSgpICogKHRoaXMubWF4U3RhckR1cmF0aW9uIC0gdGhpcy5taW5TdGFyRHVyYXRpb24pO1xuICAgICAgICB0aGlzLnRpbWVyID0gMDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIOenu+mZpOaXp+eahOiKgueCuVxuICAgICAqIOa3u+WKoOaWsOiKgueCuVxuICAgICAqL1xuICAgIHNwYXduQm90dG9tQ2FyZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5wbGF5ZXJDb250cm9sTm9kZUFycmF5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGxldCBkZXN0b3J5Tm9kZSA9IHRoaXMucGxheWVyQ29udHJvbE5vZGVBcnJheTtcbiAgICAgICAgICAgIFBva2VyVXRpbC5kZXN0b3J5QXJyYXkoZGVzdG9yeU5vZGUpO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXJDb250cm9sTm9kZUFycmF5ID0gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCJzcGF3bkJvdHRvbUNhcmQgXCIgKyB0aGlzLnBva2VyUGxheWVyWzBdLmxlbmd0aCk7XG4gICAgICAgIHRoaXMuY3JlYXRlQm90dG9tQ2FyZCgpXG5cbiAgICB9LFxuXG4gICAgY3JlYXRlQm90dG9tQ2FyZDogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIGxldCBzdGFydFBvc2l0aW9uID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBva2VyUGxheWVyWzBdLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvLyDkvb/nlKjnu5nlrprnmoTmqKHmnb/lnKjlnLrmma/kuK3nlJ/miJDkuIDkuKrmlrDoioLngrlcbiAgICAgICAgICAgIHZhciBuZXdTdGFyID0gY2MuaW5zdGFudGlhdGUodGhpcy5jYXJkUHJlZmFiKTtcbiAgICAgICAgICAgIC8vIG5ld1N0YXIuc2V0UGljTnVtKFwiaVwiK2kpO1xuICAgICAgICAgICAgbmV3U3Rhci5nZXRDb21wb25lbnQoJ0NhcmQnKS5waWNOdW0gPSB0aGlzLnBva2VyUGxheWVyWzBdW2ldO1xuICAgICAgICAgICAgdGhpcy5wbGF5ZXJDb250cm9sTm9kZUFycmF5LnB1c2gobmV3U3Rhcik7XG4gICAgICAgICAgICAvLyB0aGlzLm5vZGUuYWRkQ2hpbGQobmV3U3Rhcik7XG4gICAgICAgICAgICB0aGlzLmxheW91dENvbnRhaW5lci5ub2RlLmFkZENoaWxkKG5ld1N0YXIpO1xuICAgICAgICAgICAgbGV0IGhlaWdodCA9IHRoaXMuZ3JvdW5kLmhlaWdodCAvIDIgKiAtMTtcbiAgICAgICAgICAgIHN0YXJ0UG9zaXRpb24gPSBpICogdGhpcy5jYXJkV2lkdGg7XG4gICAgICAgICAgICBpZiAoaSA+IDEzKSB7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gaGVpZ2h0IC0gMTUwXG4gICAgICAgICAgICAgICAgc3RhcnRQb3NpdGlvbiA9IChpIC0gMTMpICogdGhpcy5jYXJkV2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBuZXdTdGFyLnNldFBvc2l0aW9uKGNjLnYyKC0yMDAgKyB0aGlzLnN0YXJ0Q2FyZFBvc3Rpb24gKyBzdGFydFBvc2l0aW9uLCBoZWlnaHQpKTtcbiAgICAgICAgfVxuICAgIH0sXG5cblxuICAgIGdldE5ld1N0YXJQb3NpdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmFuZFggPSAwO1xuICAgICAgICAvLyDmoLnmja7lnLDlubPpnaLkvY3nva7lkozkuLvop5Lot7Pot4Ppq5jluqbvvIzpmo/mnLrlvpfliLDkuIDkuKrmmJ/mmJ/nmoQgeSDlnZDmoIdcbiAgICAgICAgdmFyIHJhbmRZID0gdGhpcy5ncm91bmRZICsgTWF0aC5yYW5kb20oKSAqIHRoaXMucGxheWVyLmdldENvbXBvbmVudCgnUGxheWVyJykuanVtcEhlaWdodCArIDUwO1xuICAgICAgICAvLyDmoLnmja7lsY/luZXlrr3luqbvvIzpmo/mnLrlvpfliLDkuIDkuKrmmJ/mmJ8geCDlnZDmoIdcbiAgICAgICAgdmFyIG1heFggPSB0aGlzLm5vZGUud2lkdGggLyAyO1xuICAgICAgICByYW5kWCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIgKiBtYXhYO1xuICAgICAgICAvLyDov5Tlm57mmJ/mmJ/lnZDmoIdcbiAgICAgICAgcmV0dXJuIGNjLnYyKHJhbmRYLCByYW5kWSk7XG4gICAgfSxcbiAgICBnZXRDYXJkQm90dG9tUG9zaXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJhbmRYID0gdGhpcy5jdXJyZW50Q2FyZFBvc2l0aW9uO1xuICAgICAgICB2YXIgcmFuZFkgPSAwO1xuICAgICAgICB0aGlzLmN1cnJlbnRDYXJkUG9zaXRpb24gPSB0aGlzLmN1cnJlbnRDYXJkUG9zaXRpb24gKyB0aGlzLmNhcmRXaWR0aDtcbiAgICAgICAgcmV0dXJuIGNjLnYyKHJhbmRYLCByYW5kWSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIC8vIOavj+W4p+abtOaWsOiuoeaXtuWZqO+8jOi2hei/h+mZkOW6pui/mOayoeacieeUn+aIkOaWsOeahOaYn+aYn1xuICAgICAgICAvLyDlsLHkvJrosIPnlKjmuLjmiI/lpLHotKXpgLvovpFcbiAgICAgICAgLy8gaWYgKHRoaXMudGltZXIgPiB0aGlzLnN0YXJEdXJhdGlvbikge1xuICAgICAgICAvLyAgICAgdGhpcy5nYW1lT3ZlcigpO1xuICAgICAgICAvLyAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7ICAgLy8gZGlzYWJsZSBnYW1lT3ZlciBsb2dpYyB0byBhdm9pZCBsb2FkIHNjZW5lIHJlcGVhdGVkbHlcbiAgICAgICAgLy8gICAgIHJldHVybjtcbiAgICAgICAgLy8gfVxuICAgICAgICAvLyB0aGlzLnRpbWVyICs9IGR0O1xuICAgIH0sXG5cbiAgICBnYWluU2NvcmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zY29yZSArPSAxO1xuICAgICAgICAvLyDmm7TmlrAgc2NvcmVEaXNwbGF5IExhYmVsIOeahOaWh+Wtl1xuICAgICAgICB0aGlzLnNjb3JlRGlzcGxheS5zdHJpbmcgPSAnU2NvcmU6ICcgKyB0aGlzLnNjb3JlO1xuICAgICAgICAvLyDmkq3mlL7lvpfliIbpn7PmlYhcbiAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheUVmZmVjdCh0aGlzLnNjb3JlQXVkaW8sIGZhbHNlKTtcbiAgICB9LFxuXG4gICAgZ2FtZU92ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXIuc3RvcEFsbEFjdGlvbnMoKTsgLy/lgZzmraIgcGxheWVyIOiKgueCueeahOi3s+i3g+WKqOS9nFxuICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoJ2dhbWUnKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgKiDmiorniYzlj5Hnu5nlm5vlrrZcbiAgICAqL1xuICAgIHB1Ymxpc2hQb2tlcnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wb2tlclBsYXllciA9IFtdO1xuICAgICAgICBsZXQgcG9rZXJBcnJheSA9IHRoaXMuY2FyZEFycmF5LnNsaWNlKDApO1xuICAgICAgICBsZXQgaG9zdD1wYXJzZUludChNYXRoLnJhbmRvbSgpICogNCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgcGxheWVyUG9rZXJBcnJheSA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAyNzsgaisrKSB7XG4gICAgICAgICAgICAgICAgbGV0IHBva2VyTnVtID0gTWF0aC5yYW5kb20oKSAqIHBva2VyQXJyYXkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHBva2VyTnVtID0gcGFyc2VJbnQocG9rZXJOdW0pO1xuICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHBva2VyQXJyYXkuc3BsaWNlKHBva2VyTnVtLCAxKTtcbiAgICAgICAgICAgICAgICBwbGF5ZXJQb2tlckFycmF5LnB1c2godmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmKGk9PWhvc3QmJmo9PTI2KXtcbiAgICAgICAgICAgICAgICAgICAgLy/pmo/mnLrmlrnnmoTmnIDlkI7kuIDlvKDniYzlgZrkuLtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lSG9zdD0gUG9rZXJVdGlsLnF1YXJ5UG9rZXJUeXBlVmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZExvZyhcIuacrOi9rua4uOaIj+S4u1wiK1Bva2VyVXRpbC5xdWFyeVR5cGUodGhpcy5nYW1lSG9zdClcbiAgICAgICAgICAgICAgICAgICAgK1wiLOS4u+eJjFwiK1Bva2VyVXRpbC5xdWFyeVBva2VyVmFsdWUodmFsdWUpK1wi5ZyoXCIrdGhpcy5leHBhbmRQbGF5ZXIoaSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucG9rZXJQbGF5ZXIucHVzaChwbGF5ZXJQb2tlckFycmF5KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNwYXduQm90dG9tQ2FyZCgpO1xuXG4gICAgfSxcbiAgICBleHBhbmRQbGF5ZXI6ZnVuY3Rpb24obG9jYXRpb24pe1xuICAgICAgICBzd2l0Y2gobG9jYXRpb24pe1xuICAgICAgICAgICAgY2FzZSAwOnJldHVybiBcIuiHquW3sVwiXG4gICAgICAgICAgICBjYXNlIDE6cmV0dXJuIFwi5LiL5a62XCJcbiAgICAgICAgICAgIGNhc2UgMjpyZXR1cm4gXCLlr7nlrrZcIlxuICAgICAgICAgICAgY2FzZSAzOnJldHVybiBcIuS4iuWutlwiICAgXG4gICAgICAgIH1cblxuICAgIH0sXG4gICAgYXBwZW5kTG9nOmZ1bmN0aW9uKHN0cmluZyl7XG4gICAgICAgIHRoaXMucGxheUxvZz10aGlzLnBsYXlMb2crXCJcXG5cIitzdHJpbmc7XG4gICAgICAgIHRoaXMubG9nTGFiZWwuc3RyaW5nPXRoaXMucGxheUxvZztcbiAgICB9XG4gICAgXG4gICAgXG5cblxuXG59KTtcbiJdfQ==